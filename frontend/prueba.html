<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Login con Google (Firebase → FastAPI)</title>
</head>
<body>
  <button id="btn">Entrar con Google</button>

  <pre id="out"></pre>

  <script type="module">
    // 1) Importar SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

    // 2) Configuración de tu app web (Firebase → Configuración del proyecto → Tus apps)
    const firebaseConfig = {
      apiKey: "AIzaSyC1C8N9YtLPakSoM-JIqpHbRcIz-wpXz2o",
      authDomain: "espotifai-81056.firebaseapp.com",
      projectId: "espotifai-81056",
      storageBucket: "espotifai-81056.firebasestorage.app",
      messagingSenderId: "116600974901",
      appId: "1:116600974901:web:d5739649bdaa970cbd4b7c",
      measurementId: "G-H9E60M6MSW"
    };

    // 3) Inicializar
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // 4) Flujo: obtener id_token de Google → enviarlo a tu backend → recibir tu JWT
    async function loginConGoogle(){
      const res = await signInWithPopup(auth, provider);
      const idToken = await res.user.getIdToken(); // ID token de Google

      const r = await fetch("http://localhost:8000/auth/google", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id_token: idToken })
      });
      const data = await r.json(); // { access_token, token_type }
      document.getElementById("out").textContent = JSON.stringify(data, null, 2);
      console.log("JWT backend:", data.access_token);
    }

    document.getElementById("btn").onclick = loginConGoogle;
  </script>
</body>
</html>
